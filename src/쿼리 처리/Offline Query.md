## Offline Query πΆ Platinum IV
λ³µμ΅ν• μ—°μ‚°μ„ λ‹¨μν™”ν•κΈ° μ„ν•΄, λ‹µμ— μν–¥μ„ μ£Όμ§€ μ•λ„λ΅ μΏΌλ¦¬ μμ„λ¥Ό μ¬λ°°μ—΄ν•΄ λ‹µμ„ μ°Ύλ” ν…ν¬λ‹‰

[μ—°μµ λ¬Έμ  (λ°±μ¤€ 13306λ²)](https://www.acmicpc.net/problem/13306)

ν•΄λ‹Ή λ¬Έμ μ—μ„λ” κ°„μ„ μ„ λλ” μ—°μ‚° N-1λ², λ‘ μ •μ  μ‚¬μ΄μ— κ²½λ΅κ°€ μλ”μ§€ μ°Ύλ” μ—°μ‚° Qλ²μ„ ν•΄μ•Ό ν•λ‹¤.  
μ΄λ―Έ μλ” κΈΈμ„ λκ³ , μ—°κ²°μ„±μ„ ν™•μΈν•λ” κ²ƒμ€ μ‹κ°„ μ•μ— ν•΄κ²°ν•  μ μ—†μ–΄ λ³΄μΈλ‹¤.  
ν•μ§€λ§ λ°λ€λ΅ μƒκ°ν•΄λ³΄λ©΄, μ…λ ¥λ μΏΌλ¦¬λ¥Ό λ§μ§€λ§‰λ¶€ν„° κ±°κΎΈλ΅ μ—†λ” κΈΈμ„ λ§λ“¤λ©΄μ„ μ—°κ²°μ„±μ„ ν™•μΈν•λ” κ²ƒμ€ DSUλ¥Ό μ¨μ„ μ‰½κ² νλ³„ν•  μ μλ‹¤.  
μ΄λ ‡κ² μ¤ν”„λΌμΈ μΏΌλ¦¬μ ν•µμ‹¬μ€ ν•κΈ° νλ“  μ—°μ‚°μ„ ν•κΈ° μ‰¬μ΄ μ—°μ‚°μΌλ΅ κ°€κ³µν•μ—¬ ν•΄κ²°ν•λ” κ²ƒμ΄λ‹¤.

1λ² μμ μ—μ„μ μΏΌλ¦¬ μμ„λ” μ•„λμ™€ κ°™λ‹¤.

2κ³Ό 3μ μ—°κ²°μ„± ν™•μΈ  
3κ³Ό 3μ λ¶€λ¨ μ‚¬μ΄μ κ°„μ„  μ κ±°  
2κ³Ό 3μ μ—°κ²°μ„± ν™•μΈ  
1κ³Ό 2μ μ—°κ²°μ„± ν™•μΈ  
2μ™€ 2μ λ¶€λ¨ μ‚¬μ΄μ κ°„μ„  μ κ±°

λ¨λ“  κ°„μ„ μ„ λμ€ ν›„, λ§μ§€λ§‰ μΏΌλ¦¬λ¶€ν„° μ‚΄ν΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™λ‹¤.

2μ™€ 2μ λ¶€λ¨ μ‚¬μ΄μ κ°„μ„  μ¶”κ°€  
1κ³Ό 2μ μ—°κ²°μ„± ν™•μΈ  
2κ³Ό 3μ μ—°κ²°μ„± ν™•μΈ  
3κ³Ό 3μ λ¶€λ¨ μ‚¬μ΄μ κ°„μ„  μ¶”κ°€  
2κ³Ό 3μ μ—°κ²°μ„± ν™•μΈ  

μ΄ λ¬Έμ μ—μ„μ μ‹κ°„λ³µμ΅λ„ : O(Q*Ξ±(N))

``` c++
/** http://boj.kr/7a09286e97084de1916987aaf5eb9888 μ μ¶ μ½”λ“ */
#include<bits/stdc++.h>
using namespace std;

const int MAX = 200'001;

int parent[MAX], p[MAX];

struct q {
    int a, b, c;
};

int find(int x) {
    if(x==parent[x]) return x;
    return parent[x] = find(parent[x]);
}

void merge(int x, int y) {
    x = find(x);
    y = find(y);

    if(x<y) parent[y] = x;
    else parent[x] = y;
}

int main(void) {
    ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);
    int N, Q; cin >> N >> Q;
    for(int i=2;i<=N;i++) cin >> p[i];
    for(int i=1;i<=N;i++) parent[i]=i;

    /** λ―Έλ¦¬ μΏΌλ¦¬λ¥Ό μ „λ¶€ λ°›μ•„λ†“μ */
    vector<q> query(Q+N-1);
    for(int i=0;i<Q+N-1;i++) {
        cin >> query[i].a >> query[i].b;
        if(query[i].a==1) cin >> query[i].c;
    }

    /** λ§μ§€λ§‰ μΏΌλ¦¬λ¶€ν„° κ±°κΎΈλ΅ μ—°κ²° ν™•μΈν•¨ (κ°™μ€ μ§‘ν•©μ— μ†ν•λ©΄ μ„λ΅ μ—°κ²°λ¨) */
    stack<string> stk;
    for (int i=Q+N-2;i>=0;i--) {
        if(query[i].a==0) {
            merge(query[i].b, p[query[i].b]);
        } else {
            if(find(query[i].b)==find(query[i].c)) stk.push("YES\n");
            else stk.push("NO\n");
        }
    }
    while(!stk.empty()) {
        cout << stk.top(); stk.pop();
    }
}
```
